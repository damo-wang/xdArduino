### 实训课程计划：Arduino环境监控设备设计

#### 课程描述
本课程旨在指导学生使用Arduino及配件制作一个环境监控设备，结合多路复用器、传输总线的方式，增加了对系统设计和软硬件集成能力的要求，锻炼了学生解决复杂问题的能力。同时，便于更好地扩展功能和提升性能，对有想法的学生，提供了发挥能力的空间。学生将在一天内完成项目设计、硬件搭建、代码编写和数据展示。

#### 课程目标
- 了解Arduino的基本开发环境和工作原理
- 学习如何通过多路复用器扩展传感器数量
- 掌握I2C和SPI接口传感器的数据读取方法
- 实现环境监控设备的设计、组装与调试

#### 课程结构

1. **开场介绍**（1小时）
   - 介绍课程目标和要求
   - 讲解Arduino开发平台、I2C和SPI协议
   - 说明多路复用器的作用和实现方式
   - 分组与项目评价标准

2. **项目讲解与示范**（1小时）
   - 讲解如何连接传感器、多路复用器与Arduino
   - 演示I2C/SPI传感器的数据读取
   - 介绍优化代码的方法，以提高采集频率和精度

3. **项目设计**（1小时）
   - 各小组领取项目任务
   - 各小组完成项目方案
   - 小组成员分工

4. **项目调试与完善**（3小时）
   - 各小组开始设计、搭建并编写程序
   - 指导老师提供技术支持，解决学生遇到的问题
   - 调试硬件连接和传感器数据采集
   - 进一步优化代，确保设备能够稳定运行
   - （期间包含午休，午休时间不计算在内）

5. **项目展示与总结**（1小时）
   - 各小组展示设备，介绍设计思路和实现方式
   - 代码和文档提交代码库

#### 器材参考列表

1. **Arduino主板**（每组1块）
   - Arduino UNO或Nano主板
2. **传感器**（尽可能多，结合多路复用器使用）
   - **温湿度传感器**：用于测量环境温湿度，I2C接口
   - **气压传感器**：测量大气压力，I2C或SPI接口
   - **光照传感器**：测量环境光强度，I2C接口
   - **空气质量传感器**：检测空气中有害气体，模拟信号输出
   - **噪声传感器**：检测环境噪声，模拟信号输出
   - **土壤湿度传感器**：模拟信号输出
   - **风速传感器**：模拟信号输出或脉冲信号输出
3. **多路复用器**
   - 用于扩展模拟信号输入，推荐使用16:1或8:1模拟复用器
4. **显示设备**
   - 2*15 LED点阵显示模块或1602 LCD屏
5. **电池电量监测模块**
   - 监测电池电压，显示剩余电量，模拟信号输出
6. **连接线与面包板**
   - 面包板和杜邦线若干
7. **电源模块**
   - USB电源线或5V供电模块

#### 其他事项

1. **前期准备**
   - 提前调试每组的器材，确保其正常工作
   - 准备好开发环境（Arduino IDE）和参考代码
2. **后勤支持**
   - 确保每个小组有足够的工作空间和电源插座
   - 安排助教协助学生解决硬件连接与编程问题
3. **项目评估标准**
   - **功能完整性**（40%）：设备能否正确采集并显示环境数据
   - **创新与设计**（30%）：设计的创新性和功能扩展
   - **团队合作与表达**（20%）：团队协作情况及项目展示
   - **代码质量**（10%）：代码的规范性和系统的稳定性

#### 优化方案
- **多路复用器的使用**：通过使用多路复用器扩展模拟传感器的数量，在保持Arduino I/O资源的情况下，增加更多传感器。
- **I2C/SPI传感器的优先选择**：使用I2C和SPI接口传感器，以减少I/O引脚占用并提高数据采集速度。
- **代码优化**：通过分时采集和数据缓存的方式，提高数据采集频率，避免延时函数的过度使用，确保多传感器的高效协同工作。

## BOM
### 方案A：高级环境监测项目BOM表（总费用：174.5元）
| 编号 | 元件                         | 数量 | 单价（人民币/元） | 总价（人民币/元） | 备注                                                    |
|------|------------------------------|------|-------------------|-------------------|---------------------------------------------------------|
| 1    | Arduino Mega开发板           | 1    | 50               | 50               | 更多I/O端口，适合多传感器连接和更复杂的数据处理          |
| 2    | DHT11温湿度传感器            | 1    | 10               | 10               | 基础温湿度传感器，DHT22更精确但稍贵                      |
| 3    | 2x16 LCD显示屏               | 1    | 15               | 15               | 用于显示数据，I2C接口LCD减少占用端口                    |
| 4    | 面包板                       | 1    | 5                | 5                | 连接各个传感器的电路                                    |
| 5    | 杜邦线                       | 20   | 0.2              | 4                | 各类杜邦线，建议多备几根                                 |
| 6    | 电阻（常规1kΩ或10kΩ）        | 5    | 0.1              | 0.5              | 根据需要选择合适电阻                                     |
| 7    | 蜂鸣器                       | 1    | 2                | 2                | 用于报警                                                |
| 8    | 9V电池+连接器                | 1    | 10               | 10               | 提供独立电源                                            |
| 9    | MQ-2气体传感器               | 1    | 15               | 15               | 用于检测空气中的可燃气体浓度，如CO、烟雾等               |
| 10   | 光照传感器（光敏电阻模块）    | 1    | 5                | 5                | 检测环境光照强度                                         |
| 11   | 声音传感器模块               | 1    | 8                | 8                | 检测环境噪声水平                                         |
| 12   | BMP280气压传感器             | 1    | 15               | 15               | 检测环境气压和温度，适合户外环境监测                     |
| 13   | 多通道ADC模块（如ADS1115）    | 1    | 20               | 20               | 提供额外的模拟输入通道，提高采集精度和速度               |
| 14   | I2C总线模块                  | 1    | 10               | 10               | 高速I2C通信，用于连接多个传感器模块                      |
| 15   | RTC实时时钟模块（DS3231）     | 1    | 10               | 10               | 提供时间戳，便于数据记录                                 |


### 方案B：基础环境监测项目BOM表（总费用：101.3元）
| 编号 | 元件                        | 数量 | 单价（人民币/元） | 总价（人民币/元） | 备注                                               |
|------|-----------------------------|------|-------------------|-------------------|----------------------------------------------------|
| 1    | Arduino Mega开发板          | 1    | 50               | 50               | 主控制器，支持更多端口                              |
| 2    | DHT11温湿度传感器           | 1    | 10               | 10               | 基础温湿度检测，若更精确可选DHT22                    |
| 3    | 2x16 LCD显示屏（I2C接口）   | 1    | 15               | 15               | 用于显示传感器数据，直接连接至Mega的I2C接口          |
| 4    | 面包板                      | 1    | 5                | 5                | 连接各个传感器                                      |
| 5    | 杜邦线                      | 20   | 0.2              | 4                | 各类杜邦线，建议多备几根                            |
| 6    | 蜂鸣器                      | 1    | 2                | 2                | 用于报警                                           |
| 7    | 9V电池+连接器               | 1    | 10               | 10               | 独立电源                                           |
| 8    | 光照传感器（光敏电阻模块）   | 1    | 5                | 5                | 检测光照强度                                        |
| 9    | 电阻（常规1kΩ或10kΩ）       | 3    | 0.1              | 0.3              | 用于电路调整                                        |

### 最终方案

| 编号 | 元件                   | 数量 | 备注                                           |
|------|------------------------|------|------------------------------------------------|
| 1    | Arduino Mega开发板     | 1    | 主控制器，支持更多端口                          |
| 2    | 高精度温湿度传感器     | 1    | 精度更高，适合对温湿度数据要求高的场景           |
| 3    | 2x16 LCD显示屏（I2C接口） | 1    | 用于显示传感器数据，I2C接口方便与多个设备连接     |
| 4    | 面包板                 | 1    | 连接各个传感器                                  |
| 5    | 杜邦线                 | 20   | 各类杜邦线，建议多备几根                         |
| 6    | 蜂鸣器                 | 1    | 用于报警                                        |
| 7    | 9V电池+连接器          | 1    | 独立电源                                        |
| 8    | 光照传感器             | 1    | 检测环境光照强度                                |
| 9    | 气体传感器             | 1    | 用于检测空气中的可燃气体浓度，如CO、烟雾等       |
| 10   | 气压和温度传感器       | 1    | 精度更高，可检测气压和温度，适合更复杂环境的监测  |
| 11   | 多通道ADC模块          | 1    | 提供额外的模拟输入通道，提高采集精度和速度       |
| 12   | 电阻（常规1kΩ或10kΩ）  | 3    | 用于电路调整                                    |

## code

```c
/*请确保在Arduino IDE中安装了以下库：
DHT库（用于DHT11温湿度传感器）
LiquidCrystal_I2C库（用于I2C LCD显示）
*/
#include <Wire.h>
#include <LiquidCrystal_I2C.h>
#include <DHT.h>

// 定义DHT11引脚和类型
#define DHTPIN 2
#define DHTTYPE DHT11

// 定义光敏电阻引脚
#define LIGHT_SENSOR_PIN A0

// 定义蜂鸣器引脚
#define BUZZER_PIN 9

// 初始化DHT11和LCD
DHT dht(DHTPIN, DHTTYPE);
LiquidCrystal_I2C lcd(0x27, 16, 2);  // 请根据LCD地址调整，常见地址是0x27或0x3F

// 光照和温湿度阈值
const int LIGHT_THRESHOLD = 500;     // 假设500为较暗环境阈值，可根据测试调整
const float TEMP_THRESHOLD = 30.0;   // 温度阈值，超过即报警
const float HUMIDITY_THRESHOLD = 70.0; // 湿度阈值，超过即报警

void setup() {
  // 初始化串口、LCD、DHT11、蜂鸣器
  Serial.begin(9600);
  lcd.begin();
  lcd.backlight();
  dht.begin();
  pinMode(BUZZER_PIN, OUTPUT);
  digitalWrite(BUZZER_PIN, LOW);

  // LCD初始显示
  lcd.setCursor(0, 0);
  lcd.print("Env Monitor Init");
  delay(2000);
  lcd.clear();
}

void loop() {
  // 读取温湿度数据
  float temp = dht.readTemperature();
  float humidity = dht.readHumidity();

  // 读取光照强度（0-1023）
  int lightLevel = analogRead(LIGHT_SENSOR_PIN);

  // 检查读取是否成功
  if (isnan(temp) || isnan(humidity)) {
    lcd.setCursor(0, 0);
    lcd.print("DHT Error!");
    Serial.println("Failed to read from DHT sensor!");
    delay(2000);
    return;
  }

  // 在LCD显示温湿度数据
  lcd.setCursor(0, 0);
  lcd.print("Temp: ");
  lcd.print(temp);
  lcd.print("C");

  lcd.setCursor(0, 1);
  lcd.print("Humi: ");
  lcd.print(humidity);
  lcd.print("%");

  // 在串口监视器输出数据
  Serial.print("Temperature: ");
  Serial.print(temp);
  Serial.print(" C, Humidity: ");
  Serial.print(humidity);
  Serial.print(" %, Light: ");
  Serial.println(lightLevel);

  // 判断是否触发报警
  bool alarmTriggered = false;
  if (temp > TEMP_THRESHOLD || humidity > HUMIDITY_THRESHOLD || lightLevel < LIGHT_THRESHOLD) {
    alarmTriggered = true;
  }

  // 激活或关闭蜂鸣器
  if (alarmTriggered) {
    digitalWrite(BUZZER_PIN, HIGH);
    lcd.setCursor(10, 1);
    lcd.print("ALARM");  // 显示报警信息
  } else {
    digitalWrite(BUZZER_PIN, LOW);
    lcd.setCursor(10, 1);
    lcd.print("     ");  // 清除报警信息
  }

  // 每秒更新一次
  delay(1000);
}

```
注意事项
LCD I2C地址：在LiquidCrystal_I2C lcd(0x27, 16, 2);部分，根据你的LCD实际地址调整（通常为0x27或0x3F）。
阈值调整：根据实际需求和传感器测试数据，适当调整温度、湿度和光照阈值。
